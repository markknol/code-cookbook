<!DOCTYPE html> <html lang="en" id="page"> <head> <meta charset="utf-8"/> <meta name="viewport" content="width=device-width"/> <title>Add a map - Haxe Code Cookbook</title> <base href="./../.."/>  <link rel="stylesheet" type="text/css" href="http://haxe.org/css/bootstrap.min.css"/> <link rel="stylesheet" type="text/css" href="css/styles.min.css"/> <link rel="icon" href="http://haxe.org/favicon.ico"/>  <meta name="twitter:creator" content="@haxe_org"/>  <meta property="og:title" content="Add a map - Haxe Code Cookbook"/> <meta property="og:type" content="article"/> <meta property="og:url" content="http://code.haxe.org/"/> <meta property="og:image" content="http://code.haxe.org/img/share.jpg"/> <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,700italic,400italic" rel="stylesheet" type="text/css"/> <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400" rel="stylesheet" type="text/css"/> </head><body><nav class="section nav dark"><div class="navbar navbar-fixed-top navbar-inverse"><div class="navbar-inner"><button class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse" type="button"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="brand haxe-logo" href="http://haxe.org/"><img alt="Haxe" height="21" onerror="this.src='http://haxe.org/img/haxe-logo-horizontal-on-dark.png'" src="http://haxe.org/img/haxe-logo-horizontal-on-dark.svg" width="107"/></a><a class="brand sub ide" href="./index.html">CODE</a><div class="nav-collapse collapse"><ul class="nav"> <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-book"></i> Browse <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="category/beginner/index.html">Beginner <small class="category-count">(3)</small></a></li><li class="active"><a href="category/macros/index.html">Macros <small class="category-count">(13)</small></a></li><li><a href="category/other/index.html">Other <small class="category-count">(5)</small></a></li><li><a href="category/abstract-types/index.html">Abstract types <small class="category-count">(3)</small></a></li><li><a href="category/design-patterns/index.html">Design-patterns <small class="category-count">(3)</small></a></li><li><a href="category/principles/index.html">Principles <small class="category-count">(3)</small></a></li></ul></li><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-tags"></i> Tags <b class="caret"></b></a><ul class="dropdown-menu"> <li><a href="tag/abstract-type.html"><i class="fa fa-tag"></i> abstract-type <small class="category-count">(3)</small></a></li>  <li><a href="tag/macro-function.html"><i class="fa fa-tag"></i> macro-function <small class="category-count">(7)</small></a></li> <li><a href="tag/iterator.html"><i class="fa fa-tag"></i> iterator <small class="category-count">(3)</small></a></li>   <li><a href="tag/enum.html"><i class="fa fa-tag"></i> enum <small class="category-count">(2)</small></a></li> <li><a href="tag/class.html"><i class="fa fa-tag"></i> class <small class="category-count">(3)</small></a></li>  <li><a href="tag/validation.html"><i class="fa fa-tag"></i> validation <small class="category-count">(3)</small></a></li>  <li><a href="tag/building-fields.html"><i class="fa fa-tag"></i> building-fields <small class="category-count">(6)</small></a></li>  <li><a href="tag/build-macro.html"><i class="fa fa-tag"></i> build-macro <small class="category-count">(6)</small></a></li>    </ul></li><li class="divider"></li> <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="/documentation/">Learn Haxe <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="http://haxe.org/documentation/">Introduction</a></li><li class="divider"></li><li><a href="http://haxe.org/manual/">Manual</a></li><li><a href="http://api.haxe.org">API Documentation</a></li><li class="divider"></li><li><a href="http://try.haxe.org">Try Haxe</a></li><li><a href="http://lib.haxe.org">Haxelib</a></li><li class="active"><a href="http://code.haxe.org">Code Cookbook</a></li></ul></li><li class=" dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Connect <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="https://github.com/HaxeFoundation"><i class="fa fa-github"></i> Github</a></li><li><a href="https://github.com/HaxeFoundation/haxe/issues"><i class="fa fa-github"></i> Bug reports</a></li><li><a href="http://stackoverflow.com/questions/tagged/haxe"><i class="fa fa-stack-exchange"></i> Stack Overflow</a></li><li><a href="http://groups.google.com/group/haxelang?hl=en"><i class="fa fa-envelope-o"></i> Google Groups</a></li><li><a href="http://webchat.freenode.net/?channels=haxe"><i class="fa fa-comments-o"></i> IRC</a></li><li><a href="http://haxe.org/blog"><i class="fa fa-rss"></i> Blog</a></li><li class="divider"></li><li><a href="https://plus.google.com/communities/103302587329918132234"><i class="fa fa-google-plus"></i> Google+</a></li><li><a href="https://www.facebook.com/haxe.org/"><i class="fa fa-facebook"></i> Facebook</a></li><li><a href="https://twitter.com/search?q=%23haxe"><i class="fa fa-twitter"></i> #haxe</a></li><li><a href="https://twitter.com/haxelang"><i class="fa fa-twitter"></i> @haxelang</a></li><li><a href="https://twitter.com/haxe_org"><i class="fa fa-twitter"></i> @haxe_org</a></li><li class="divider"></li><li><a href="http://haxe.org/foundation/contact.html">Contact</a></li></ul></li></ul></div></div></div></nav><div class="main-content"><header class="hero-unit-small"><div class="container"><div class="row"><h1>Haxe Code Cookbook</h1></div></div></header><main class="container"><section class="row"><nav class="span4 sidebar-toc" id="sidebar"><h3>Table of contents</h3><ul class="unstyled"><li><a href="category/beginner/index.html">Beginner</a><ul class="unstyled"><li><a href="category/beginner/declare-classes.html">Declare classes</a></li><li><a href="category/beginner/declare-functions.html">Declare functions</a></li><li><a href="category/beginner/hello-world.html">Hello world</a></li></ul></li><br/><li><a href="category/macros/index.html">Macros</a><ul class="unstyled"><li><a href="category/macros/add-git-commit-hash-in-build.html">Add git commit-hash in build</a></li><li><a href="category/macros/add-parameters-as-fields.html">Add parameters as fields</a></li><li><a href="category/macros/assert-with-values.html">Assert macro that shows sub-expression values</a></li><li class="active"><a href="category/macros/build-map.html">Add a map</a></li><li><a href="category/macros/build-property-with-inline-getter.html">Add property with getter</a></li><li><a href="category/macros/build-static-field.html">Add a static field</a></li><li><a href="category/macros/build-value-objects.html">Create value-objects</a></li><li><a href="category/macros/combine-objects.html">Combine two or more structures</a></li><li><a href="category/macros/completion-from-url.html">Code completion from URL</a></li><li><a href="category/macros/enum-abstract-values.html">Get all values of an @:enum abstract</a></li><li><a href="category/macros/extract-enum-value.html">Extract values from known enum instances</a></li><li><a href="category/macros/generate-dispatch-code.html">Generate dispatch code</a></li><li><a href="category/macros/validate-json.html">Validates a .JSON file compile-time</a></li></ul></li><br/><li><a href="category/other/index.html">Other</a><ul class="unstyled"><li><a href="category/other/grid-iterator.html">Grid iterator</a></li><li><a href="category/other/reverse-iterator.html">Reverse iterator</a></li><li><a href="category/other/sort-array.html">Sorting arrays</a></li><li><a href="category/other/step-iterator.html">Stepped iterator</a></li><li><a href="category/other/using-filesystem.html">Using File system</a></li></ul></li><br/><li><a href="category/abstract-types/index.html">Abstract types</a><ul class="unstyled"><li><a href="category/abstract-types/emailaddress.html">EmailAddress</a></li><li><a href="category/abstract-types/rounded float.html">Rounded Float</a></li><li><a href="category/abstract-types/tempeatures.html">Temperatures</a></li></ul></li><br/><li><a href="category/design-patterns/index.html">Design-patterns</a><ul class="unstyled"><li><a href="category/design-patterns/factory.html">Factory</a></li><li><a href="category/design-patterns/lazy-initialization.html">Lazy initialization</a></li><li><a href="category/design-patterns/singleton.html">Singleton</a></li></ul></li><br/><li><a href="category/principles/index.html">Principles</a><ul class="unstyled"><li><a href="category/principles/inheritance.html">Inheritance</a></li><li><a href="category/principles/null-safety.html">Null safety</a></li><li><a href="category/principles/everything-is-an-expression.html">Everything is an expression</a></li></ul></li><br/></ul></nav><article class="span8"><h1>Add a map</h1> <blockquote> <p>This snippet demonstrates how to add a map field to a type.</p></blockquote> <p>We can use expression reification to turn basic types into appropriate expressions. Maps, however, are a <em>complex type</em>. As such they need to be treated a little differently.</p> <p>A map is a container of key-value pairs that can be observed as an array of <code>key =&gt; value</code> expressions. For example: <code>var m = [ 1 =&gt; "ONE", 2 =&gt; "TWO"]</code>. With that in mind, building a map field is no different than creating an array of the correct expressions.</p> <p>Note the use of <code>macro</code> to create the <code>key =&gt; value</code> expression. Also note the use of expression reification: <code>$v{}</code> to generate expressions from specified values, and <code>$a{}</code> to create the expression array.</p> <h2>Build macro</h2> <pre><code class="prettyprint haxe">import haxe.macro.Context;
import haxe.macro.Expr;

class MapBuilder {
  public static macro function build(names : Array&lt;String&gt;) : Array&lt;Field&gt; {
    // The context is the class this build macro is called on
    var fields = Context.getBuildFields();
    // A map is an array of `key =&gt; value` expressions
    var map : Array&lt;Expr&gt; = [];
    // We add a `key =&gt; value` expression for every name
    for (name in names) {
      // Expression reification generates expression from argument
      map.push(macro $v{name} =&gt; $v{haxe.crypto.Sha256.encode(name)});
    }
    // We push the map into the context build fields
    fields.push({
      // The line position that will be referenced on error
      pos: Context.currentPos(),
      // Field name
      name: "namesHashed",
      // Attached metadata (we are not adding any)
      meta: null,
      // Field type is Map&lt;String, String&gt;, `map` is the map
      kind: FieldType.FVar(macro : Map&lt;String, String&gt;, macro $a{map}),
      // Documentation (we are not adding any)
      doc: null,
      // Field visibility
      access: [Access.APublic, Access.AStatic]
    });
    // Return the context build fields to build the type
    return fields;
  }
}</code></pre> <h2>Usage</h2> <pre><code class="prettyprint haxe">@:build(MapBuilder.build(["Aaron", "Bobbi", "Carol", "Dennis", "Eric", "Frank"]))
class Main {
  static function main() {
    trace(namesHashed.get("Bobbi"));
  }
}</code></pre> <blockquote> <p>Learn about macros here: <a href="http://haxe.org/manual/macro.html">http://haxe.org/manual/macro.html</a></p> <p>Author: <a href="http://github.com/dstrekelj">Domagoj Štrekelj</a></p></blockquote><div class="tags"><hr/>Tags: <span class="tag"><i class="fa fa-tag"></i>&nbsp;<a href="tag/build-macro.html">build-macro</a></span><span class="tag"><i class="fa fa-tag"></i>&nbsp;<a href="tag/building-fields.html">building-fields</a></span></div><hr/><div class="contribution"><i class="fa fa-lightbulb-o"></i> <a href="https://github.com/HaxeFoundation/code-cookbook/edit/master/./assets/content/cookbook/Macros/build-map.md">Suggest improvement</a> | <i class="fa fa-exclamation-circle"></i> <a href="https://github.com/HaxeFoundation/code-cookbook/issues/new?title=[Add a map]&body=%0A%0ASources:%0A*%20http://code.haxe.org/category/macros/build-map.html%0A*%20https://github.com/HaxeFoundation/code-cookbook/tree/master/./assets/content/cookbook/Macros/build-map.md">Report issue</a> |<i class="fa fa-plus-circle"></i> <a href="https://github.com/HaxeFoundation/code-cookbook/new/master/./assets/content/cookbook/Macros/snippet-name.md/?filename=snippet-name.md">Add new snippet</a></div></article></section></main></div><footer class="section dark site-footer"><div class="container"><div class="copyright"> <p>&copy;2016&nbsp;<a class="hf-link" href="http://haxe.org/foundation/" title="Haxe Foundation Website">Haxe Foundation</a> |&nbsp;<a href="https://github.com/HaxeFoundation/code-cookbook" title="Haxe Code Cookbook on Github">Code Cookbook on Github</a> </p></div></div></footer><link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css"/>  <link rel="stylesheet" type="text/css" href="css/haxe-nav.min.css"/><script src="http://haxe.org/js/jquery.min.js"></script><script src="http://haxe.org/js/bootstrap.min.js"></script><script src="js/highlighter.js"></script><script>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');  ga('create', 'UA-74262827-2', 'auto');  ga('send', 'pageview');</script></body></html>